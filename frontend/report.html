<!doctype html>
<html>
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Generate Report â€¢ ReportApp</title>
  <link rel="stylesheet" href="/static/styles.css?v=10" />
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700;800&display=swap" rel="stylesheet">
  <!-- Tailwind via CDN so report page can use the same utility classes as index.html -->
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    :root{ --accent-1: #667eea; --accent-2: #764ba2; --muted: #6b7280; }
    body { background: linear-gradient(180deg,#f7fbff 0%, #ffffff 30%); color:#0f172a; margin:0; font-family: 'Inter', system-ui, -apple-system, 'Segoe UI', Roboto, 'Helvetica Neue', Arial; }
    .wrap { min-height:100vh; display:flex; flex-direction:column; max-width:1200px; margin:0 auto; padding:20px; }
    header { display:flex; align-items:center; justify-content:space-between; padding:16px 18px; background: transparent; }
    header h1 { margin:0; font-size:20px; color:var(--accent-1); display:flex; align-items:center; gap:10px; font-weight:700; }
    header button { padding:8px 12px; border:none; border-radius:10px; background:linear-gradient(90deg,var(--accent-1),var(--accent-2)); color:#fff; font-weight:700; cursor:pointer; box-shadow:0 8px 18px rgba(102,126,234,0.14); }
    main { flex:1; padding:12px 0; }
    .card { background: linear-gradient(180deg,#ffffff,#fbfbff); border:1px solid rgba(16,24,40,0.04); border-radius:12px; padding:18px; box-shadow:0 6px 18px rgba(16,24,40,0.06); }
    .row { display:grid; grid-template-columns: repeat(auto-fit, minmax(220px, 1fr)); gap:12px; }
    label { font-size:13px; color:var(--muted); }
    input, select { width:100%; padding:10px 12px; border:1px solid rgba(15,23,42,0.06); border-radius:10px; background: white; color:#0f172a; }
    .btn { padding:10px 14px; border:none; border-radius:10px; font-weight:700; cursor:pointer; }
    .btn-primary { background: linear-gradient(90deg,var(--accent-1),var(--accent-2)); color:white; box-shadow:0 10px 24px rgba(102,126,234,0.14); }
    .btn-secondary { background: rgba(15,23,42,0.06); color:var(--muted); border:1px solid rgba(15,23,42,0.04); }
    .btn-primary:hover, .btn-secondary:hover { transform: translateY(-2px); }
    .status { font-size:13px; color:var(--muted); margin-top:6px; }
    pre { background:#ffffff; padding:12px; border-radius:8px; overflow:auto; border:1px solid rgba(15,23,42,0.04); }
    /* Layout for parameters generated by report.js */
    .row { display: grid; grid-template-columns: repeat(auto-fit,minmax(180px,1fr)); gap:12px; }
    .param-item { display:flex; flex-direction:column; gap:6px; }
    .adhoc-row { display:flex; gap:8px; align-items:center; margin-bottom:8px; }
    .adhoc-row input { padding:8px 10px; }
    /* Result table styling */
    .result-table { width:100%; border-collapse:collapse; margin-top:8px; }
    .result-table thead th { text-align:left; border-bottom:1px solid rgba(15,23,42,0.08); padding:8px; }
    .result-table tbody td { padding:8px; border-bottom:1px solid rgba(15,23,42,0.04); }
    /* Responsive tweaks */
    @media (max-width:640px){ .wrap { padding:12px; } header h1 { font-size:18px; } }
  </style>
</head>
<body>
  <div class="wrap">
    <header>
      <h1><span>ðŸ§ª</span> Generate Report</h1>
      <div>
        <button id="backBtn">â¬… Back</button>
      </div>
    </header>
    <main>
      <div class="card mb-4">
        <div class="flex flex-col gap-4">
          <div class="flex items-center justify-between flex-wrap gap-3">
            <div>
              <div class="font-semibold">Report Execution</div>
              <div class="status">Select a definition or run ad-hoc basic generation.</div>
            </div>
            <div class="flex gap-2 flex-wrap">
              <button id="btnDiag" class="btn btn-secondary">Connectivity</button>
              <button id="btnGenerate" class="btn btn-secondary" title="Simple inspection report">Quick Generate</button>
              <button id="btnRunDef" class="btn btn-primary" title="Run stored procedure">Run Definition</button>
            </div>
          </div>
          <div class="grid grid-cols-1 sm:grid-cols-2 gap-3">
            <div>
              <label class="text-sm text-gray-500">Definition</label>
              <div class="flex items-center gap-2">
                <select id="defSelect"></select>
                <button id="genParamsBtn" class="btn btn-secondary px-2 py-1">Generate Params</button>
              </div>
            </div>
            <div>
              <label class="text-sm text-gray-500">Ad-hoc Report Name</label>
              <input id="reportNameInput" placeholder="Optional report name" />
            </div>
            <div class="col-span-2" id="defParamsContainer"></div>
            <div class="col-span-2 mt-2">
              <label class="text-sm text-gray-500">Ad-hoc Parameters</label>
              <div id="adhocParams" class="mt-2"></div>
              <div class="mt-2"><button id="addAdhocParamBtn" class="btn btn-secondary">Add Parameter</button></div>
            </div>
            <div class="col-span-2 text-sm text-gray-500" id="defInfo"></div>
          </div>
        </div>
      </div>

      <div class="card">
        <div class="mb-3 font-semibold">Result</div>
        <div class="flex items-center justify-between gap-3">
          <div id="result">No action yet.</div>
          <div class="flex gap-2">
            <button id="exportCsvBtn" class="btn btn-secondary">Export CSV</button>
            <button id="exportExcelBtn" class="btn btn-secondary">Export Excel</button>
            <button id="exportTxtBtn" class="btn btn-secondary">Export TXT</button>
          </div>
        </div>
        <div id="reportExtra" class="mt-3 text-sm text-gray-500"></div>
      </div>
    </main>
  </div>
    <script>
      // Theme toggle initializer for report page
      (function(){
        const btn = document.getElementById('themeToggleBtn');
        function applyTheme(t){
          if (t === 'dark') document.documentElement.classList.add('dark'); else document.documentElement.classList.remove('dark');
          if (btn) btn.textContent = t === 'dark' ? 'â˜€ï¸' : 'ðŸŒ™';
        }
        const saved = localStorage.getItem('theme');
        if (saved) applyTheme(saved);
        else {
          const prefersDark = window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches;
          applyTheme(prefersDark ? 'dark' : 'light');
        }
        if (btn) btn.addEventListener('click', () => {
          const isDark = document.documentElement.classList.toggle('dark');
          const t = isDark ? 'dark' : 'light';
          localStorage.setItem('theme', t);
          applyTheme(t);
        });
      })();
    </script>
      <script>
        // Ensure modals can overlay everything: move .modal elements to document.body and bump z-index.
        (function(){
          function normalizeModals(){
            document.querySelectorAll('.modal').forEach(m => {
              try{
                if (m.parentElement !== document.body) document.body.appendChild(m);
                m.style.position = 'fixed';
                m.style.inset = '0';
                m.style.zIndex = '100000';
              }catch(e){console.warn('modal normalize error', e)}
            });
          }
          if (document.readyState === 'complete' || document.readyState === 'interactive') normalizeModals();
          else document.addEventListener('DOMContentLoaded', normalizeModals);
          window.addEventListener('load', normalizeModals);
        })();
      </script>
      <script>
        // Prevent multiple modals stacking: when one modal becomes visible, hide the others.
        (function(){
          const modals = () => Array.from(document.querySelectorAll('.modal'));
          function onModalVisible(changed){
            const visible = modals().filter(m => getComputedStyle(m).display !== 'none');
            if (visible.length <= 1) return;
            const keep = changed && getComputedStyle(changed).display !== 'none' ? changed : visible[visible.length-1];
            modals().forEach(m => {
              if (m !== keep) {
                m.style.display = 'none';
              } else {
                m.style.zIndex = '100000';
                const inner = m.querySelector('.modal-content');
                if (inner) inner.style.zIndex = '100001';
              }
            });
          }
          modals().forEach(m => {
            const obs = new MutationObserver((mutations)=>{
              mutations.forEach(mu=>{ if (mu.type === 'attributes') onModalVisible(m); });
            });
            obs.observe(m, { attributes: true, attributeFilter: ['style','class'] });
          });
          document.addEventListener('click', (ev)=>{
            const target = ev.target.closest('[data-opens-modal]');
            if (!target) return;
            const id = target.getAttribute('data-opens-modal');
            const m = document.getElementById(id);
            if (m) onModalVisible(m);
          });
        })();
      </script>
  <script src="/static/report.js?v=4"></script>
</body>
</html>
